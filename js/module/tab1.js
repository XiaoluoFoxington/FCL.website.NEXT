import{loadModule}from"/js/module/moduleLoader.js";export async function xf_init(){console.log("xf_init()");await xf_loadTab1Content();xf_addEventListeners();xf_loadImportantAnnouncement();xf_loadAnnouncement();xf_checkAndShowSponsorRemind()}export function xf_addEventListeners(){document.getElementById("loadIntroFclBtn").addEventListener("click",xf_loadIntroFclBtn_Click)}export async function xf_loadIntroFclBtn_Click(){const loadContent=await loadModule("/js/module/loadContent.js");loadContent.xf_loadHtmlContentFromUrl("/page/introFcl.html",document.getElementById("introFcl"))}export async function xf_loadTab1Content(){const loadContent=await loadModule("/js/module/loadContent.js");await loadContent.xf_loadHtmlContentFromUrl("/page/tab1.html",document.getElementById("tab1"))}export async function xf_loadImportantAnnouncement(){const loadContent=await loadModule("/js/module/loadContent.js");const utils=await loadModule("/js/module/utils.js");const headEl=document.getElementById("xf_importantAnnouncementHead");const contentEl=document.getElementById("xf_importantAnnouncementContent");const closeBtnEl=document.getElementById("xf_importantAnnouncementCloseBtn");if(!headEl||!contentEl||!closeBtnEl){return}const CHECKSUM_STORAGE_KEY="xf_importantAnnouncement_checksum";const savedChecksum=utils.xf_readLocalStorage(CHECKSUM_STORAGE_KEY);console.log("tab1：加载重要公告内容：已存校验值：",savedChecksum);const content=await loadContent.fetchItems("/data/content/importantAnnouncement.html","text");const currentChecksum=utils.xf_calculateChecksum(content);console.log("tab1：加载重要公告内容：当前校验值：",currentChecksum);if(parseInt(savedChecksum,10)===currentChecksum){console.log("tab1：加载重要公告内容：公告为旧");headEl.remove()}else{console.log("tab1：加载重要公告内容：公告为新");contentEl.innerHTML=content;closeBtnEl.addEventListener("click",(function(){utils.xf_writeLocalStorage(CHECKSUM_STORAGE_KEY,currentChecksum);headEl.remove()}))}}export async function xf_loadAnnouncement(){const loadContent=await loadModule("/js/module/loadContent.js");const utils=await loadModule("/js/module/utils.js");const CHECKSUM_STORAGE_KEY="xf_announcement_checksum";const savedChecksum=utils.xf_readLocalStorage(CHECKSUM_STORAGE_KEY);console.log("tab1：加载公告内容：已存校验值：",savedChecksum);const contentElement=await loadContent.xf_getHtmlContent("/data/content/announcement.html");if(contentElement instanceof HTMLSpanElement&&contentElement.textContent.startsWith("获取 HTML 内容：出错：")){console.error("tab1：加载公告内容：出错：",contentElement.textContent);return}const currentContentText=contentElement?.innerHTML||"";const currentChecksum=utils.xf_calculateChecksum(currentContentText);console.log("tab1：加载公告内容：当前校验值：",currentChecksum);const contentContainer=document.getElementById("xf_announcementContent");const titleElement=document.getElementById("xf_announcementTitle");if(!contentContainer||!titleElement){console.error("tab1：加载公告内容：出错：找不到容器");return}contentContainer.innerHTML="";if(contentElement){contentContainer.appendChild(contentElement)}if(savedChecksum!==null&&parseInt(savedChecksum,10)===currentChecksum){console.log("tab1：加载公告内容：公告为旧");titleElement.innerHTML="公告"}else{console.log("tab1：加载公告内容：公告为新");titleElement.innerHTML='公告 <span style="color: #ff0;">●</span>'}const panelItem=document.getElementById("xf_announcement");if(panelItem){if(!panelItem.dataset.xfAnnouncementListenerAdded){panelItem.addEventListener("click",(function(){titleElement.innerHTML="公告";utils.xf_writeLocalStorage(CHECKSUM_STORAGE_KEY,currentChecksum.toString())}));panelItem.dataset.xfAnnouncementListenerAdded="true"}}}export async function xf_checkAndShowSponsorRemind(){const utils=await loadModule("/js/module/utils.js");const main=await loadModule("/js/main.js");const notShowSponsorRemind=utils.xf_readLocalStorage("notShowSponsorRemind")==="true";const visitCount=await main.xf_getUserVisitCount();const sponsorRemindEl=document.getElementById("sponsorRemind");if(!sponsorRemindEl||!utils.isMultipleOfTen(visitCount)||notShowSponsorRemind){return}sponsorRemindEl.className="mdui-panel-item mdui-panel-item-open";sponsorRemindEl.style.background="linear-gradient(135deg, #40ff8040 0%, #40ffff40 100%)";sponsorRemindEl.innerHTML=`\n    <div class="mdui-panel-item-header mdui-ripple">\n      <div>我们需要您的赞助！</div>\n      <i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>\n    </div>\n    <div class="mdui-panel-item-body">\n      <div class="mdui-typo">\n        <p>您好，您已访问此网站 ${visitCount} 次！</p>\n        <p>下载流量高昂，网站运营困难，我们一直坚守开源、无广告，使此站保持公益性质。如果您觉得此站对您有帮助且您经济条件允许，欢迎赞助我们！您的赞助将帮助我们继续运营此站，非常感谢！</p>\n        <p>这不是强制要求，您完全可以选择不赞助。显示此提示仅仅是因为您的访问次数达到了10的倍数。如果您不点击“永久关闭”，此提示将会在您的访问次数再次达到10的倍数时显示。</p>\n      </div>\n      <a class="mdui-btn mdui-btn-block mdui-btn-raised mdui-ripple" id="xf_sponsorRemindCloseBtn">永久关闭</a>\n    </div>\n  `;const closeBtnEl=document.getElementById("xf_sponsorRemindCloseBtn");if(closeBtnEl){closeBtnEl.addEventListener("click",(function(){sponsorRemindEl.remove();utils.xf_writeLocalStorage("notShowSponsorRemind","true")}))}}