import{loadModule}from"/js/module/moduleLoader.js";export async function xf_init(){console.log("xf_init()");await xf_loadTab1Content();xf_addEventListeners();xf_loadImportantAnnouncement();xf_loadAnnouncement()}export function xf_addEventListeners(){document.getElementById("loadIntroFclBtn").addEventListener("click",xf_loadIntroFclBtn_Click)}export async function xf_loadIntroFclBtn_Click(){const loadContent=await loadModule("/js/module/loadContent.js");loadContent.xf_loadHtmlContentFromUrl("/page/introFcl.html",document.getElementById("introFcl"))}export async function xf_loadTab1Content(){const loadContent=await loadModule("/js/module/loadContent.js");await loadContent.xf_loadHtmlContentFromUrl("/page/tab1.html",document.getElementById("tab1"))}export async function xf_loadImportantAnnouncement(){const loadContent=await loadModule("/js/module/loadContent.js");const utils=await loadModule("/js/module/utils.js");const headEl=document.getElementById("xf_importantAnnouncementHead");const contentEl=document.getElementById("xf_importantAnnouncementContent");const closeBtnEl=document.getElementById("xf_importantAnnouncementCloseBtn");if(!headEl||!contentEl||!closeBtnEl){return}const CHECKSUM_STORAGE_KEY="xf_importantAnnouncement_checksum";const savedChecksum=utils.xf_readLocalStorage(CHECKSUM_STORAGE_KEY);console.log("tab1：加载重要公告内容：已存校验值：",savedChecksum);const content=await loadContent.fetchItems("/data/content/importantAnnouncement.html","text");const currentChecksum=utils.xf_calculateChecksum(content);console.log("tab1：加载重要公告内容：当前校验值：",currentChecksum);if(parseInt(savedChecksum,10)===currentChecksum){console.log("tab1：加载重要公告内容：公告为旧");headEl.remove()}else{console.log("tab1：加载重要公告内容：公告为新");contentEl.innerHTML=content;closeBtnEl.addEventListener("click",(function(){utils.xf_writeLocalStorage(CHECKSUM_STORAGE_KEY,currentChecksum);headEl.remove()}))}}export async function xf_loadAnnouncement(){const loadContent=await loadModule("/js/module/loadContent.js");const utils=await loadModule("/js/module/utils.js");const CHECKSUM_STORAGE_KEY="xf_announcement_checksum";const savedChecksum=utils.xf_readLocalStorage(CHECKSUM_STORAGE_KEY);console.log("tab1：加载公告内容：已存校验值：",savedChecksum);const contentElement=await loadContent.xf_getHtmlContent("/data/content/announcement.html");if(contentElement instanceof HTMLSpanElement&&contentElement.textContent.startsWith("获取 HTML 内容：出错：")){console.error("tab1：加载公告内容：出错：",contentElement.textContent);return}const currentContentText=contentElement?.innerHTML||"";const currentChecksum=utils.xf_calculateChecksum(currentContentText);console.log("tab1：加载公告内容：当前校验值：",currentChecksum);const contentContainer=document.getElementById("xf_announcementContent");const titleElement=document.getElementById("xf_announcementTitle");if(!contentContainer||!titleElement){console.error("tab1：加载公告内容：出错：找不到容器");return}contentContainer.innerHTML="";if(contentElement){contentContainer.appendChild(contentElement)}if(savedChecksum!==null&&parseInt(savedChecksum,10)===currentChecksum){console.log("tab1：加载公告内容：公告为旧");titleElement.innerHTML="公告"}else{console.log("tab1：加载公告内容：公告为新");titleElement.innerHTML='公告 <span style="color: #ff0;">●</span>'}const panelItem=document.getElementById("xf_announcement");if(panelItem){if(!panelItem.dataset.xfAnnouncementListenerAdded){panelItem.addEventListener("click",(function(){titleElement.innerHTML="公告";utils.xf_writeLocalStorage(CHECKSUM_STORAGE_KEY,currentChecksum.toString())}));panelItem.dataset.xfAnnouncementListenerAdded="true"}}}