import{loadModule}from"/js/module/moduleLoader.js";export async function xf_getHtmlContent(url,onProgress){console.log(`获取 HTML 内容：${url}`);const utils=await loadModule("/js/module/utils.js");return fetch(url).then((response=>{if(!response.ok)throw new Error(`获取 HTML 内容：出错：HTTP：${response.status}`);const contentLength=response.headers.get("Content-Length");let loaded=0;if(!onProgress)return response.text();const reader=response.body.getReader(),chunks=[],total=contentLength?parseInt(contentLength,10):null;return new Promise(((resolve,reject)=>{!function read(){reader.read().then((({done:done,value:value})=>{if(done){const html=(new TextDecoder).decode(utils.xf_concatChunks(chunks));resolve(html)}else chunks.push(value),loaded+=value.length,onProgress(loaded,total),read()})).catch(reject)}()}))})).then((html=>(new DOMParser).parseFromString(html,"text/html").body.firstElementChild)).catch((e=>{console.error("获取 HTML 内容：出错：",e);const errorElement=document.createElement("span");return errorElement.textContent=`获取 HTML 内容：出错：${e.message}`,errorElement}))}export function xf_loadHtmlContent(htmlContent,container){console.log(`加载 HTML 内容到指定容器：容器：${container.id}`);try{for(;container.firstChild;)container.firstChild.remove();container.appendChild(htmlContent)}catch(e){console.error("加载 HTML 内容到指定容器：出错：",e);const errorElement=document.createElement("span");errorElement.textContent=`加载 HTML 内容到指定容器：出错：${e.message}`,container.appendChild(errorElement)}}export async function xf_loadHtmlContentFromUrl(url,container){console.log(`获取并加载 HTML 内容到指定容器：内容：${url}；容器：${container.id}`);const utils=await loadModule("/js/module/utils.js");try{const loadingElement=document.createElement("div");loadingElement.className="xf-loading",loadingElement.id="xf-loading-progress",loadingElement.innerHTML="正在加载<br>?%<br>0 / ?",container.innerHTML="",container.appendChild(loadingElement);const htmlContent=await xf_getHtmlContent(url,((loaded,total)=>{const percent=total?Math.round(loaded/total*100):0,loadedFormatted=utils.xf_formatBytes(loaded),totalFormatted=total?utils.xf_formatBytes(total):"?",progressElement=document.getElementById("xf-loading-progress");progressElement&&(progressElement.innerHTML=`正在加载<br>${percent}%<br>${loadedFormatted} / ${totalFormatted}`)}));htmlContent&&xf_loadHtmlContent(htmlContent,container),mdui.mutation()}catch(e){console.error("获取并加载 HTML 内容到指定容器：",e),container.innerHTML=`<div class="xf-error-text">获取并加载 HTML 内容到指定容器：出错：${e.message}</div>`}}