import{loadModule}from"/js/module/moduleLoader.js";export async function xf_getHtmlContent(e,t){console.log(`获取 HTML 内容：${e}`);const n=await loadModule("/js/module/utils.js");return fetch(e).then((e=>{if(!e.ok)throw new Error(`获取 HTML 内容：出错：HTTP：${e.status}`);const o=e.headers.get("Content-Length");let r=0;if(!t)return e.text();const s=e.body.getReader(),l=[],a=o?parseInt(o,10):null;return new Promise(((e,o)=>{!function read(){s.read().then((({done:o,value:s})=>{if(o){const t=(new TextDecoder).decode(n.xf_concatChunks(l));e(t)}else l.push(s),r+=s.length,t(r,a),read()})).catch(o)}()}))})).then((e=>(new DOMParser).parseFromString(e,"text/html").body.firstElementChild)).catch((e=>{console.error("获取 HTML 内容：出错：",e);const t=document.createElement("span");return t.textContent=`获取 HTML 内容：出错：${e.message}`,t}))}export function xf_loadHtmlContent(e,t){console.log(`加载 HTML 内容到指定容器：容器：${t.id}`);try{for(;t.firstChild;)t.firstChild.remove();t.appendChild(e)}catch(e){console.error("加载 HTML 内容到指定容器：出错：",e);const n=document.createElement("span");n.textContent=`加载 HTML 内容到指定容器：出错：${e.message}`,t.appendChild(n)}}export async function xf_loadHtmlContentFromUrl(e,t){console.log(`获取并加载 HTML 内容到指定容器：内容：${e}；容器：${t.id}`);const n=await loadModule("/js/module/utils.js");try{const o=document.createElement("div");o.className="xf-loading",o.id="xf-loading-progress",o.innerHTML="正在加载<br>?%<br>0 / ?",t.innerHTML="",t.appendChild(o);const r=await xf_getHtmlContent(e,((e,t)=>{const o=t?Math.round(e/t*100):0,r=n.xf_formatBytes(e),s=t?n.xf_formatBytes(t):"?",l=document.getElementById("xf-loading-progress");l&&(l.innerHTML=`正在加载<br>${o}%<br>${r} / ${s}`)}));r&&xf_loadHtmlContent(r,t),mdui.mutation()}catch(e){console.error("获取并加载 HTML 内容到指定容器：",e),t.innerHTML=`<div class="xf-error-text">获取并加载 HTML 内容到指定容器：出错：${e.message}</div>`}}