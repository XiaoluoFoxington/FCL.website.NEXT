import{loadModule}from"/js/module/moduleLoader.js";export async function loadReleaseHistory(e,n){console.log("加载Release历史：",e,n);try{await async function(){try{if(!function(e){if("string"!=typeof e)return!1;const n=e.split("/");if(2!==n.length)return!1;const[i,t]=n;return""!==i.trim()&&""!==t.trim()}(e))return void onError("仓库全名非法");const i=document.getElementById(n);if(!i)return void onError("目标元素不存在");const t=await async function(e){const n=`https://api.github.com/repos/${e}/releases`,i=await fetch(n);if(!i.ok){const e={404:"404：找不到仓库",403:"403：API请求超限",500:"500：GH内部错误"}[i.status]||`${i.status}：${i.statusText}`;throw new Error(e)}return await i.json()}(e);if(0===t.length)return void onError("没有Release数据");!function(e,n){n.innerHTML="";const i=document.createElement("div");i.id="release-panel-container",i.classList.add("mdui-panel"),i.setAttribute("mdui-panel","");const t=document.createDocumentFragment();e.forEach(((e,n)=>{const i=`\n        <div class="mdui-panel-item ${0===n?"mdui-panel-item-open":""}" id="release-panel-${n}">\n          <div class="mdui-panel-item-header mdui-ripple">\n            <div class="mdui-panel-item-title">${e.name||"未命名版本"}</div>\n            <div class="mdui-panel-item-summary">${e.tag_name}</div>\n            <div class="mdui-panel-item-summary">${new Date(e.published_at).toLocaleString()}</div>\n            <i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>\n          </div>\n          <div class="mdui-panel-item-body mdui-typo">\n            ${marked.parse(e.body||"无发布说明")}\n          </div>\n        </div>`,a=document.createElement("div");a.innerHTML=i,t.appendChild(a.firstElementChild)})),i.appendChild(t),n.appendChild(i),mdui.mutation()}(t,i)}catch(e){onError(e)}}()}catch(e){onError(e)}function onError(e){const i="加载Release历史：出错："+("string"==typeof e?e:e.message);e instanceof Error?console.error(i,e):console.error(i);const t=document.getElementById(n);t&&(t.innerHTML=`\n      <div class="mdui-panel" mdui-panel>\n        <div class="mdui-panel-item mdui-panel-item-open" style="background-color: #ff000040;">\n          <div class="mdui-panel-item-header mdui-ripple">\n            <div>加载出错</div>\n            <i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>\n          </div>\n          <div class="mdui-panel-item-body mdui-typo">\n            <p>${i}</p>\n          </div>\n        </div>\n      </div>`,mdui.mutation())}}